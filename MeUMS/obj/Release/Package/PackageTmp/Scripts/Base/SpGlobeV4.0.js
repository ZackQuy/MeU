Sp.Globe = function (a, b) {
    this.isInit = !1; this._spMapClsid = "CLSID:3a4f9192-65a8-11d5-85c1-0001023952c1"; this._spObjectClsid = "CLSID:3A4F9199-65A8-11D5-85C1-0001023952C1"; this._updateUrl = Sp.GetRootUrl() + "/download/SkylineGlobeSetup.exe"; if (null == Sp.Globe._instance) {
        this._InitLicense(b); this._containerId = a; try {
            this._containerId != void 0 && this._containerId != "" && ($("#" + this._containerId).append('<object id="SPAPITE3DWindow" classid="' + this._spMapClsid + '"></object>'), $("#SPAPITE3DWindow").attr({
                name: "SPAPITE3DWindow",
                width: "100%", height: "100%", BorderStyle: 0, Caption: "\u4e09\u7ef4\u5730\u56fe"
            })); var c = document.createElement("object"); c.setAttribute("name", "SPAPITEObj"); c.setAttribute("id", "SPAPITEObj"); c.setAttribute("classid", this._spObjectClsid); document.body.appendChild(c)
        } catch (d) { if (d.number == -2147220989) d.description = "\u9519\u8bef: \u540c\u4e00\u4e2a\u9875\u9762\u4e2d\u521b\u5efa\u4e86\u591a\u4e2a\u4e09\u7ef4\u5730\u56fe\u5bf9\u8c61"; throw d; } this._TEObj = c; c = this.GetVersion(); if (null == c) {
            c = "\u60a8\u4f7f\u7528\u7684\u6d4f\u89c8\u5668\u4e0d\u662fIE 9.0+\u6d4f\u89c8\u5668\uff0c\u4e09\u7ef4\u529f\u80fd\u65e0\u6cd5\u6b63\u5e38\u663e\u793a\uff0c\u8bf7\u60a8\u5207\u6362\u6d4f\u89c8\u5668\u518d\u8bd5\u3002";
            var e = navigator.userAgent.toLowerCase(); if (e.match(/msie/) != null || e.match(/trident/) != null) c = "\u4e3a\u4e86\u60a8\u80fd\u6b63\u5e38\u4f7f\u7528\u7cfb\u7edf\u8bf7<a href='" + this._updateUrl + "' target='_blank'>\u4e0b\u8f7d</a>\u5b89\u88c5\u5730\u56fe\u63d2\u4ef6\u3002\u5b89\u88c5\u540e\u8bf7\u6309F5\u5237\u65b0\u9875\u9762"; e = $("#" + this._containerId); e.length > 0 && (e.empty(), e.css("textAlign", "center"), e.append(c)); this.isInit = !1; return null
        } else if (c.Major == 6 && c.Minor == 6 && c.Build == 1) this.isInit = !0, window.onerror =
        function (a) { if (RegExp("Object doesn't support this property or method.*|.*License required.*|\u5bf9\u8c61\u4e0d\u652f\u6301\u6b64\u5c5e\u6027\u6216\u65b9\u6cd5.*", "gi").test(a)) return alert("\u6e29\u99a8\u63d0\u793a\uff1a\u8be5\u529f\u80fd\u9700\u8981license\u8bb8\u53ef\u652f\u6301\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458"), !0 }; else return e = $("#" + this._containerId), e.length > 0 && (e.empty(), e.css("textAlign", "center"), c = "\u60a8\u7684\u5730\u56fe\u63d2\u4ef6\u7248\u672c\u8fc7\u4f4e\uff0c\u8bf7\u66f4\u65b0\u4e3a\u6700\u65b0\u7248\u672c\u3002\u8bf7<a href=''" +
        this._updateUrl + "' target='_blank'>\u4e0b\u8f7d</a>\u5b89\u88c5TerraExplorer\u3002\u5b89\u88c5\u540e\u8bf7\u6309F5\u5237\u65b0\u9875\u9762", e.append(c)), this.isInit = !1, null; this._eventList = null; this._InitEvent(); Sp.Globe._instance = this
    } return Sp.Globe._instance
};
Sp.Globe.prototype = {
    _InitEvent: function () { this._OnEventHandler = Sp.Delegate(this, this._OnEvent); this._handlerName = "OnEvent"; this._initOnEvent = !1 }, AddEvent: function (a) { if (this._initOnEvent == !1) this.AddOnObjectAction(this._OnEventHandler), this._initOnEvent = !0; this._GetEventList().containHandler(this._handlerName, a) || this._GetEventList().addHandler(this._handlerName, a) }, RaiseEvent: function (a, b) {
        try { Sp.ToJson(b) } catch (c) { alert("\u4e8b\u4ef6\u53c2\u6570\u6570\u636e\u5fc5\u987b\u4e3ajson\u5bf9\u8c61"); return } var d =
        { eventName: a, eventData: b }, e = this.GetCreator(), f = e.CreateLocationHere(Sp.GlobeCUtils.GetHiddenGroup(this._TEObj), "location"); Sp.GlobeCUtils.SetTEClientData(f, "spEvent", Sp.ToJson(d)); e.DeleteObject(f.ID)
    }, RemoveEvent: function (a) { if (this._initOnEvent && (this._GetEventList().removeHandler(this._handlerName, a), a = this._GetEventList().getHandler(this._handlerName), null == a)) this._initOnEvent = !1, this.RemoveOnObjectAction(this._OnEventHandler) }, _OnEvent: function (a, b) {
        if (b.Code == 15) {
            this.RemoveOnObjectAction(this._OnEventHandler);
            var c = this.GetCreator(); this._InitLicense(); c = c.GetObject(a); null != c && c.ObjectType == 19 && c.ClientData("spEvent") != null && c.ClientData("spEvent").trim() != "" && (c = c.ClientData("spEvent"), c = Sp.ParseJson(c), this._RaiseEvent(this._handlerName, c)); this.AddOnObjectAction(this._OnEventHandler)
        }
    }, _GetEventList: function () { if (!this._eventList) this._eventList = new Sp.EventHandlerList; return this._eventList }, _RaiseEvent: function (a, b) {
        var c = this._GetEventList().getHandler(a); if (c) {
            if (b === null || typeof b === "undefined") b =
            Sp.EventArgs.Empty; c(this, b)
        }
    }, AddGlobeEvent: function (a, b) { this._TEObj.AttachEvent(a, b) }, RemoveGlobeEvent: function (a, b) { this._TEObj.DetachEvent(a, b) }, AddLoaded: function (a) { this._TEObj.AttachEvent("OnLoadFinished", a) }, RemoveLoaded: function (a) { this._TEObj.DetachEvent("OnLoadFinished", a) }, AddOnFrame: function (a) { this._TEObj.AttachEvent("OnFrame", a) }, RemoveOnFrame: function (a) { this._TEObj.DetachEvent("OnFrame", a) }, AddOnLButtonDblClk: function (a) { this._TEObj.AttachEvent("OnLButtonDblClk", a) }, RemoveOnLButtonDblClk: function (a) {
        this._TEObj.DetachEvent("OnLButtonDblClk",
        a)
    }, AddOnLButtonDown: function (a) { this._TEObj.AttachEvent("OnLButtonDown", a) }, RemoveOnLButtonDown: function (a) { this._TEObj.DetachEvent("OnLButtonDown", a) }, AddOnLButtonUp: function (a) { this._TEObj.AttachEvent("OnLButtonUp", a) }, RemoveOnLButtonUp: function (a) { this._TEObj.DetachEvent("OnLButtonUp", a) }, AddOnLButtonClicked: function (a) { this._TEObj.AttachEvent("OnLButtonClicked", a) }, RemoveOnLButtonClicked: function (a) { this._TEObj.DetachEvent("OnLButtonClicked", a) }, AddOnMouseWheel: function (a) {
        this._TEObj.AttachEvent("OnMouseWheel",
        a)
    }, RemoveOnMouseWheel: function (a) { this._TEObj.DetachEvent("OnMouseWheel", a) }, AddOnRButtonDblClk: function (a) { this._TEObj.AttachEvent("OnRButtonDblClk", a) }, RemoveOnRButtonDblClk: function (a) { this._TEObj.DetachEvent("OnRButtonDblClk", a) }, AddOnRButtonDown: function (a) { this._TEObj.AttachEvent("OnRButtonDown", a) }, RemoveOnRButtonDown: function (a) { this._TEObj.DetachEvent("OnRButtonDown", a) }, AddOnRButtonUp: function (a) { this._TEObj.AttachEvent("OnRButtonUp", a) }, RemoveOnRButtonUp: function (a) {
        this._TEObj.DetachEvent("OnRButtonUp",
        a)
    }, AddOnObjectAction: function (a) { this._TEObj.AttachEvent("OnObjectAction", a) }, RemoveOnObjectAction: function (a) { this._TEObj.DetachEvent("OnObjectAction", a) }, AddOnPrjTreeAction: function (a) { this._TEObj.AttachEvent("OnProjectTreeAction", a) }, RemoveOnPrjTreeAction: function (a) { this._TEObj.DetachEvent("OnProjectTreeAction", a) }, AddOnFileSave: function (a) { this._TEObj.AttachEvent("OnFileSave", a) }, RemoveOnFileSave: function (a) { this._TEObj.DetachEvent("OnFileSave", a) }, AddOnOnFileClosed: function (a) {
        this._TEObj.AttachEvent("OnFileClosed",
        a)
    }, RemoveOnFileClosed: function (a) { this._TEObj.DetachEvent("OnFileClosed", a) }, AddOnFileClosing: function (a) { this._TEObj.AttachEvent("OnFileSave", a) }, RemoveOnFileClosing: function (a) { this._TEObj.DetachEvent("OnFileClosing", a) }, AddOnSGWorld: function (a) { this._TEObj.AttachEvent("OnSGWorld", a) }, RemoveOnSGWorld: function (a) { this._TEObj.DetachEvent("OnSGWorld", a) }, AddOnSGWorldMessage: function (a) { this._TEObj.AttachEvent("OnSGWorldMessage", a) }, RemoveOnSGWorldMessage: function (a) {
        this._TEObj.DetachEvent("OnSGWorldMessage",
        a)
    }, GetVersion: function () { return this._TEObj.Version }, GetPrj: function () { return this._TEObj.Project }, GetAnalysis: function () { return this._TEObj.Analysis }, GetApplication: function () { return this._TEObj.Application }, GetCommand: function () { return this._TEObj.Command }, GetCoord: function () { return this._TEObj.CoordServices }, GetCreator: function () { return this._TEObj.Creator }, GetPrjTree: function () { return this._TEObj.ProjectTree }, GetTerrain: function () { return this._TEObj.Terrain }, GetWindow: function () { return this._TEObj.Window },
    GetNavigate: function () { return this._TEObj.Navigate }, GetDateTime: function () { return this._TEObj.DateTime }, GetParam: function (a) { return this._TEObj.GetParam(a) }, SetParam: function (a, b) { this._TEObj.SetParam(a, b) }, Open: function (a, b, c, d) { this.GetPrj().Open(a, b, c, d) }, _InitLicense: function (a) { if (null != a) { for (var b = document.getElementsByTagName("meta"), c = 0; c < b.length; ++c) if (b[c].name == "NetLicenseServer") return; b = $("head"); b.length > 0 && b.first().append("<meta name='NetLicenseServer' content='" + a + "' />") } }
};
Sp.Globe.GetInstance = function () { return Sp.Globe._instance }; Sp.GlobeCUtils = {};
Sp.apply(Sp.GlobeCUtils, {
    SetTEClientData: function (a, b, c) { a.ClientData[b] = c }, GetHiddenGroup: function (a, b) { var c = a.GetPrjTree(), d = "hiddenTemp"; b != void 0 && b != "" && (d = b); var e = c.HiddenGroupID, f = c.FindItem(c.HiddenGroupName + "\\" + d); f == 0 && (f = c.CreateLockedGroup(d, e)); return f }, ClearHiddenGroup: function (a, b) { var c = a.GetPrjTree(), d = "hiddenTemp"; b != void 0 && b != "" && (d = b); d = c.HiddenGroupName + "\\" + d; try { var e = c.FindItem(d); return e != 0 ? (c.DeleteItem(e), !0) : !1 } catch (f) { return !1 } }, GetRootGroup: function (a) { return a.GetPrjTree().RootID }, ActivateInternetLicence: function (a) {
        var b =
        a.GetCreator().CreatePosition(-122.4946, 37.78816, 100, 0, 0, 0, 0, 5E3), c = a.GetCreator().CreateColor(0, 255, 0, 127); b = a.GetCreator().CreateCircle(b, 1, 4294901760, c, Sp.GlobeCUtils.GetHiddenGroup(a), "Circle"); a.GetCreator().DeleteObject(b.ID)
    }, MapExtendToGlobePos: function (a, b) {
        var c = b.xmin, d = b.xmax, e = b.ymax, f = b.ymin, g = Math.abs((d - c) * 40009880 / 360), h = Math.abs((e - f) * 40009880 / 360); height = Math.sqrt(g * g + h * h) / Math.tan(26.5 * (3.14 / 180)); height = height == 0 ? 2E3 : height; return a.GetCreator().CreatePosition((d + c) / 2, (e + f) / 2,
        0, 0, 359.5, 270.1, 0, height)
    }, GlobePosToMapExtend: function (a) { var b = a.GetWindow().CenterPixelToWorld().Position; a = a.GetNavigate().GetPosition().Altitude * Math.tan(26.5 * (3.14 / 180)); a = a / 2 / 3.14 / 6371E3 * 360 / 2; return { xmin: b.x - a, ymin: b.y - a, xmax: b.x + a, ymax: b.y + a } }, GetHeight: function (a, b) { var c = Sp.Globe.GetInstance().GetTerrain(), d = c.GetGroundHeightInfo(a, b, 2, 0); return c.GetGroundHeightInfo(a, b, 2, 1).Position.Altitude - d.Position.Altitude }, CreateMessage: function (a, b, c, d, e, f) {
        var g = !1; if (null != a) if (g = Sp.Globe.GetInstance(),
        b == void 0 || b == "") g = !1; else { var h = null; c = c == null ? "\u8be6\u7ec6\u4fe1\u606f" : c; d = isNaN(d) ? 300 : parseFloat(d); e = isNaN(e) ? 300 : parseFloat(e); f = f == null ? -1 : f; /^http:\/\/.*/.test(b) ? h = g.GetCreator().CreatePopupMessage(c, b, 0, 0, d, e, f) : (h = g.GetCreator().CreatePopupMessage(c, void 0, 0, 0, d, e, f), h.InnerText = b); a.Message.MessageID = h.ID; g = !0 } return g
    }, CreatePolyline: function (a, b, c, d, e) {
        try { var f = Sp.Globe.GetInstance(), g = f.GetCreator().GeometryCreator.CreateGeometryFromWKT(a); f.GetCreator().CreatePolyline(g, b, c, d, e) } catch (h) {
            throw new error("\u4f20\u5165\u53c2\u6570\u9519\u8bef\uff0c\u8bf7\u67e5\u770b\u5e2e\u52a9");
        }
    }, CreatePolygon: function (a, b, c, d, e, f) { try { var g = Sp.Globe.GetInstance(), h = g.GetCreator().GeometryCreator.CreateGeometryFromWKT(a); g.GetCreator().CreatePolygon(h, b, c, d, e, f) } catch (i) { throw new error("\u4f20\u5165\u53c2\u6570\u9519\u8bef\uff0c\u8bf7\u67e5\u770b\u5e2e\u52a9"); } }
}); Sp.GlobeNavTools = function (a) { this._globe = a };
Sp.GlobeNavTools.prototype = {
    ZoomIn: function () { (new Sp.GlobeTools.ZoomIn(this._globe)).Execute() }, ZoomOut: function () { (new Sp.GlobeTools.ZoomOut(this._globe)).Execute() }, DragMode: function () { (new Sp.GlobeTools.DragMode(this._globe)).Execute() }, SlideMode: function () { (new Sp.GlobeTools.SlideMode(this._globe)).Execute() }, TurnTiltMode: function () { (new Sp.GlobeTools.TurnTiltMode(this._globe)).Execute() }, ThreeDMode: function () { (new Sp.GlobeTools.ThreeDMode(this._globe)).Execute() }, TnMode: function () { (new Sp.GlobeTools.TnMode(this._globe)).Execute() },
    NorthMode: function () { (new Sp.GlobeTools.NorthMode(this._globe)).Execute() }, RotateMode: function () { (new Sp.GlobeTools.RotateMode(this._globe)).Execute() }, OvalMode: function () { (new Sp.GlobeTools.OvalMode(this._globe)).Execute() }, ArcMode: function () { (new Sp.GlobeTools.ArcMode(this._globe)).Execute() }, LineMode: function () { (new Sp.GlobeTools.LineMode(this._globe)).Execute() }, ShowWater: function () { (new Sp.GlobeTools.ShowWater(this._globe)).Execute() }, ShowClouds: function () { (new Sp.GlobeTools.ShowClouds(this._globe)).Execute() },
    SnapShot: function () { (new Sp.GlobeTools.SnapShot(this._globe)).Execute() }, UndergroundMode: function () { (new Sp.GlobeTools.UndergroundMode(this._globe)).Execute() }, StopFly: function () { (new Sp.GlobeTools.StopFly(this._globe)).Execute() }, IgnoreKeys: function () { (new Sp.GlobeTools.IgnoreKeys(this._globe)).Execute() }, HideTerrain: function (a) { a == 0 || a == 1 ? (new Sp.GlobeTools.HideTerrain(this._globe)).Execute(a) : alert("\u8f93\u5165\u53c2\u6570\u65e0\u6548\uff0c\u6709\u6548\u503c\u4e3a0\u30011\uff0c\u5176\u4e2d0\u4ee3\u8868\u663e\u793a\uff0c1\u4ee3\u8868\u9690\u85cf") },
    AerialTool: function () { (new Sp.GlobeTools.AerialTool(this._globe)).Execute() }, VerticalTool: function () { (new Sp.GlobeTools.VerticalTool(this._globe)).Execute() }, HorizontalTool: function () { (new Sp.GlobeTools.HorizontalTool(this._globe)).Execute() }, D3AreaTool: function () { (new Sp.GlobeTools.D3AreaTool(this._globe)).Execute() }, TerrainAreaTool: function () { (new Sp.GlobeTools.TerrainAreaTool(this._globe)).Execute() }
}; Sp.GlobeTools = {}; Sp.GlobeTools.BaseTool = function (a) { this._globe = a };
Sp.GlobeTools.BaseTool.prototype = {
    AddActionBengin: function (a) { this._GetEventList().addHandler("ActionBengin", a) }, RemoveActionBengin: function (a) { this._GetEventList().removeHandler("ActionBengin", a) }, OnActionBengin: function (a) { this._RaiseEvent("ActionBengin", a) }, AddActionEnd: function (a) { this._GetEventList().addHandler("ActionEnd", a) }, RemoveActionEnd: function (a) { this._GetEventList().removeHandler("ActionEnd", a) }, OnActionEnd: function (a) { this._RaiseEvent("ActionEnd", a) }, _RaiseEvent: function (a, b) {
        var c =
        this._GetEventList().getHandler(a); if (c) { if (b === null || typeof b === "undefined") b = Sp.EventArgs.Empty; c(this, b) }
    }, _GetEventList: function () { if (!this._events) this._events = new Sp.EventHandlerList; return this._events }, Execute: function (a) { null == this._globe ? alert("\u6ca1\u8bbe\u7f6eGlobe\u5bf9\u8c61\uff0c\u4e0d\u80fd\u6267\u884c\u5de5\u5177") : this.OnExecute(a) }, Deactive: function (a) { this.OnDeactive(a) }, OnExecute: function () { }, OnDeactive: function () { }, GetGlobe: function () { return this._globe }, SetGlobe: function (a) {
        this._globe =
        a
    }
}; Sp.GlobeTools.ZoomIn = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.ZoomIn.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetNavigate().ZoomIn() } }); Sp.GlobeTools.ZoomOut = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.ZoomOut.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetNavigate().ZoomOut() } });
Sp.GlobeTools.DragMode = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.DragMode.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetCommand().Execute(1049, 0) } }); Sp.GlobeTools.SlideMode = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.SlideMode.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetCommand().Execute(1050, 0) } });
Sp.GlobeTools.TurnTiltMode = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.TurnTiltMode.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetCommand().Execute(1051, 0) } }); Sp.GlobeTools.ThreeDMode = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.ThreeDMode.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetCommand().Execute(1052, 0) } });
Sp.GlobeTools.TnMode = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.TnMode.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetCommand().Execute(1054, 0) } }); Sp.GlobeTools.NorthMode = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.NorthMode.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetCommand().Execute(1056, 0) } });
Sp.GlobeTools.RotateMode = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.RotateMode.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetCommand().Execute(1057, 0) } }); Sp.GlobeTools.OvalMode = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.OvalMode.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetCommand().Execute(1057, 1) } });
Sp.GlobeTools.ArcMode = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.ArcMode.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetCommand().Execute(1057, 2) } }); Sp.GlobeTools.LineMode = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.LineMode.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetCommand().Execute(1057, 3) } });
Sp.GlobeTools.StopFly = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.StopFly.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetNavigate().Stop() } }); Sp.GlobeTools.UndergroundMode = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.UndergroundMode.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetNavigate().UndergroundMode = !globe.GetNavigate().UndergroundMode } });
Sp.GlobeTools.ShowWater = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.ShowWater.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetCommand().Execute(1155, 0) } }); Sp.GlobeTools.ShowClouds = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.ShowClouds.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetCommand().Execute(1154, 0) } });
Sp.GlobeTools.SnapShot = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.SnapShot.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetCommand().Execute(1067, 0) } }); Sp.GlobeTools.IgnoreKeys = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.IgnoreKeys.superclass.constructor.apply(this, [a]) }, OnExecute: function () { var a = this.GetGlobe(); a._GetGlobe().IgnoreAccelerators = !a._GetGlobe().IgnoreAccelerators } });
Sp.GlobeTools.HideTerrain = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.HideTerrain.superclass.constructor.apply(this, [a]) }, OnExecute: function (a) { this.GetGlobe().GetCommand().Execute(1059, a) } }); Sp.GlobeTools.AerialTool = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.AerialTool.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetCommand().Execute(1035, 0) } });
Sp.GlobeTools.VerticalTool = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.VerticalTool.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetCommand().Execute(1036, 0) } }); Sp.GlobeTools.HorizontalTool = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.HorizontalTool.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetCommand().Execute(1034, 0) } });
Sp.GlobeTools.TerrainAreaTool = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.TerrainAreaTool.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetCommand().Execute(1165, 0) } }); Sp.GlobeTools.D3AreaTool = Sp.extend(Sp.GlobeTools.BaseTool, { constructor: function (a) { Sp.GlobeTools.D3AreaTool.superclass.constructor.apply(this, [a]) }, OnExecute: function () { this.GetGlobe().GetCommand().Execute(1037, 0) } });
Sp.GlobeTools.DrawTool = Sp.extend(Sp.GlobeTools.BaseTool, {
    constructor: function (a) { Sp.GlobeTools.DrawTool.superclass.constructor.apply(this, [a]); this._globe = this.GetGlobe(); this._cursor = ""; this._rootGroup = Sp.GlobeCUtils.GetRootGroup(a); this._tempGroupName = "TempDrawGroup"; this._drawGroup = -1; this._propPage = "" }, GetCursor: function () { return this._cursor }, SetCursor: function (a) { this._cursor = a }, GetDrawGroup: function () { if (this._drawGroup < 0) this._drawGroup = this._GetTempDrawGroup(); return this._drawGroup }, SetDrawGroup: function (a) {
        this._drawGroup =
        a
    }, GetPropPage: function () { return this._propPage }, SetPropPage: function (a) { this._propPage = a }, OnExecute: function () { if (this._propPage.trim() != "") { var a = this._globe.GetCreator().CreatePopupMessage("\u5c5e\u6027", this._propPage, 0, 0, 300, 200, -1); this._globe.GetWindow().ShowPopup(a) } }, _GetTempDrawGroup: function () { var a = this._globe.GetPrjTree().FindItem(this._tempGroupName); a <= 0 && (a = this._globe.GetPrjTree().CreateGroup(this._tempGroupName, this._rootGroup)); return a }
});
Sp.GlobeTools.EditTool = Sp.extend(Sp.GlobeTools.DrawTool, {
    constructor: function (a) { Sp.GlobeTools.EditTool.superclass.constructor.apply(this, [a]); this._globe = this.GetGlobe(); this._object = null; this._rButtonUpFlag = this._lButtonUpFlag = !1; this._OnRButtonUpHandler = Sp.Delegate(this, this._OnRButtonUp); this._OnLButtonUpHandler = Sp.Delegate(this, this._OnLButtonUp) }, GetObject: function () { return this._object }, OnExecute: function () {
        this._globe.GetWindow().SetInputMode(1, this.GetCursor()); this._globe.AddOnRButtonUp(this._OnRButtonUpHandler);
        this._globe.AddOnLButtonUp(this._OnLButtonUpHandler); this._rButtonUpFlag = this._lButtonUpFlag = !0
    }, OnDeactive: function (a) { this.Dettach(a) }, Dettach: function (a) {
        if (a == 0) this._globe.RemoveOnLButtonUp(this._OnLButtonUpHandler), this._lButtonUpFlag = !1; else if (a == 1) this._globe.RemoveOnRButtonUp(this._OnRButtonUpHandler), this._rButtonUpFlag = !1; else if (a == void 0) {
            if (this._lButtonUpFlag) this._globe.RemoveOnLButtonUp(this._OnLButtonUpHandler), this._lButtonUpFlag = !1; if (this._rButtonUpFlag) this._globe.RemoveOnRButtonUp(this._OnRButtonUpHandler),
            this._rButtonUpFlag = !1
        } else alert("\u4f20\u5165\u7684\u53c2\u6570\u65e0\u6548,\u6709\u6548\u53c2\u6570\u4e3a0\u30011\u6216\u8005\u4e0d\u8f93\u5165\u53c2\u6570\uff0c\u5176\u4e2d0\u4ee3\u8868\u6ce8\u9500\u5de6\u952e\uff0c1\u4ee3\u8868\u6ce8\u9500\u53f3\u952e\uff0c\u9ed8\u8ba4\u5168\u90e8\u6ce8\u9500"); !this._rButtonUpFlag && !this._lButtonUpFlag && this._globe.GetWindow().SetInputMode(0)
    }, _OnRButtonUp: function () { this.Deactive(); this._RaiseActionEnd(!1); return !0 }, _OnLButtonUp: function (a, b, c) {
        this._object =
        null; this._globe.GetPrjTree(); a = this._globe.GetWindow().PixelToWorld(b, c, -1).ObjectID; if (a != "") Sp.GlobeCUtils.ActivateInternetLicence(this._globe), this._object = this._globe.GetCreator().GetObject(a); this._RaiseActionEnd(!0)
    }, _RaiseActionEnd: function (a) { this.OnActionEnd({ Feature: this._object, IsEdit: a }) }
});
Sp.GlobeTools.DeleteTool = Sp.extend(Sp.GlobeTools.DrawTool, {
    constructor: function (a) { Sp.GlobeTools.DeleteTool.superclass.constructor.apply(this, [a]); this._globe = this.GetGlobe(); this._parentGroupId = null; this._OnRButtonUpHandler = Sp.Delegate(this, this._OnRButtonUp); this._OnLButtonUpHandler = Sp.Delegate(this, this._OnLButtonUp) }, OnExecute: function (a) { if (null != a) this._parentGroupId = a.pId; this._globe.GetWindow().SetInputMode(1, this.GetCursor()); this._globe.AddOnRButtonUp(this._OnRButtonUpHandler); this._globe.AddOnLButtonUp(this._OnLButtonUpHandler) },
    OnDeactive: function (a) { this.Dettach(a) }, Dettach: function () { this._globe.RemoveOnLButtonUp(this._OnLButtonUpHandler); this._globe.RemoveOnRButtonUp(this._OnRButtonUpHandler); this._globe.GetWindow().SetInputMode(0) }, _OnRButtonUp: function () { this.Deactive(); return !0 }, _OnLButtonUp: function (a, b, c) {
        a = this._globe; var d = a.GetPrjTree(); b = a.GetWindow().PixelToWorld(b, c, -1).ObjectID; if (b != "") if (Sp.GlobeCUtils.ActivateInternetLicence(a), c = a.GetCreator().GetObject(b).ObjectType, c == 1 || c == 2 || c == 3 || c == 17 || c == 18 || c ==
        23 || c == 14 || c == 24) { c = d.GetItemName(b); var e = d.GetNextItem(b, 15); if (e != this._parentGroupId && d.GetNextItem(e, 15) != this._parentGroupId) return alert("\u4f60\u9009\u62e9\u7684\u5bf9\u8c61\u4e0d\u5728\u7f16\u8f91\u7ec4\u4e2d\uff0c\u4e0d\u80fd\u5220\u9664\uff01"), !0; confirm("\u60a8\u786e\u5b9a\u8981\u5220\u9664\u8be5\u9009\u62e9\u5bf9\u8c61\uff1f") && (a.GetCreator().DeleteObject(b), this.OnActionEnd({ ID: b, objName: c })) } else alert("\u4f60\u9009\u62e9\u7684\u5bf9\u8c61\u7c7b\u578b\u6682\u4e0d\u652f\u6301\u5220\u9664\uff01");
        else alert("\u6ca1\u6709\u9009\u62e9\u5bf9\u8c61\uff01"); return !0
    }
});
Sp.GlobeTools.PointTool = Sp.extend(Sp.GlobeTools.DrawTool, {
    constructor: function (a) {
        Sp.GlobeTools.PointTool.superclass.constructor.apply(this, [a]); this._skyWin = a.GetWindow(); this._skyPrjTree = a.GetPrjTree(); this._skyCreator = a.GetCreator(); this._label = null; this._labelText = "\u5bf9\u8c61"; this._lineColor = "#ffffff"; this._bgColor = "#808080"; this._fontSize = 12; this._fontName = "\u5b8b\u4f53"; this._hight = 0; this._scale = 3; this._tran = 0; this._msg = ""; this._frameimg = !0; this._textColor = "#ffffff"; this._OnRButtonUpHandler =
        Sp.Delegate(this, this._OnRButtonUp); this._OnInfoTreeActionHandler = Sp.Delegate(this, this._OnInfoTreeAction); this._OnLButtonUpHandler = Sp.Delegate(this, this._OnLButtonUp)
    }, GetLabel: function () { return this._label }, SetLabel: function (a) { this._label = a }, GetText: function () { if (this._label != null) this._labelText = this._label.Text; return this._labelText }, SetText: function (a) { this._labelText = a; if (this._label != null) this._label.Text = a, this._label.TreeItem.Name = a }, GetLineColor: function () {
        if (this._label != null) this._lineColor =
        this._label.Style.LineColor.ToHTMLColor(); return this._lineColor
    }, SetLineColor: function (a) { this._lineColor = a; this._label != null && this._label.Style.LineColor.FromHTMLColor(a) }, GetBGColor: function () { if (this._label != null) this._bgColor = this._label.Style.BackgroundColor.ToHTMLColor(); return this._bgColor }, SetBGColor: function (a) { this._bgColor = a; this._label != null && this._label.Style.BackgroundColor.FromHTMLColor(a) }, SetTextColor: function (a) { this._textColor = a; this._label != null && this._label.Style.TextColor.FromHTMLColor(a) },
    GetTextColor: function () { if (this._label != null) this._textColor = this._label.Style.TextColor.ToHTMLColor(); return this._textColor }, GetFontSize: function () { if (this._label != null) this._fontsize = this._label.Style.FontSize; return this._fontsize }, SetFontSize: function (a) { this._fontsize = a; if (this._label != null) this._label.Style.FontSize = a }, GetFontName: function () { if (this._label != null) this._fontName = this._label.Style.FontName; return this._fontName }, SetFontName: function (a) {
        this._fontName = a; if (this._label != null) this._label.Style.FontName =
        a
    }, GetHight: function () { if (this._label != null) this._hight = this._label.Position.Altitude - Sp.GlobeCUtils.GetHeight(this._label.Position.X, this._label.Position.Y); return this._hight }, SetHight: function (a) { this._hight = parseFloat(a); if (this._label != null) this._label.Position.Altitude = Sp.GlobeCUtils.GetHeight(this._label.Position.X, this._label.Position.Y) + parseFloat(a) }, GetScale: function () { if (this._label != null) this._scale = this._label.Style.Scale; return this._scale }, SetScale: function (a) {
        this._scale = a; if (this._label !=
        null) this._label.Style.Scale = a
    }, GetTran: function () { if (this._label != null) this._tran = this._label.Style.BackgroundColor.GetAlpha(); return this._tran }, SetTran: function (a) { this._tran = a; this._label != null && this._label.Style.BackgroundColor.SetAlpha(a) }, GetMsg: function () { if (this._label != null && this._label.Message != null) { var a = this._label.Message.MessageID; a = 1 * a.substr(a.indexOf("_") + 1); if (a != -1) this._msg = this.GetGlobe().GetCreator().GetObject(a).innerText } return this._msg }, SetMsg: function (a) {
        this._msg = a; if (this._label !=
        null && this._label.Message != null) a = this._label.Message.MessageID, a = 1 * a.substr(a.indexOf("_") + 1), a != -1 && this.GetGlobe().GetCreator().DeleteObject(a), Sp.GlobeCUtils.CreateMessage(this._label, this._msg, "\u5bf9\u8c61\u63cf\u8ff0\u4fe1\u606f")
    }, GetFrameImg: function () { if (this._label != null) this._frameimg = /^http:\/\/.*/.test(this._label.Style.FrameFileName) ? !0 : !1; return this._frameimg }, SetFrameImg: function (a) {
        this._frameimg = a; if (this._label != null && this._frameimg === !0) this._label.Style.FrameFileName = Sp.GetRootUrl() +
        "/Images/frame-note.bmp"
    }, OnExecute: function () { this._skyWin.SetInputMode(1, this.GetCursor()); globe.AddOnRButtonUp(this._OnRButtonUpHandler); globe.AddOnLButtonUp(this._OnLButtonUpHandler) }, OnDeactive: function () { this._skyWin.SetInputMode(0); this.Dettach() }, Dettach: function () { var a = this.GetGlobe(); a.RemoveOnRButtonUp(this._OnRButtonUpHandler); a.RemoveOnLButtonUp(this._OnLButtonUpHandler); this._skyPrjTree.EndEdit() }, _OnRButtonUp: function () { this.Deactive(); this._RaiseActionEnd(!1); return !0 }, _OnLButtonUp: function (a,
    b, c) {
        a = this.GetGlobe(); b = this._skyWin.PixelToWorld(b, c, -1); if (null == this._label) {
            c = this._skyCreator; var d = c.CreateLabelStyle(0); d.FontName = this.GetFontName(); d.FontSize = this.GetFontSize(); d.FrameFileName = this.GetFrameImg(); d.TextColor.FromHTMLColor(this.GetTextColor()); d.BackgroundColor.FromHTMLColor(this.GetBGColor()); d.BackgroundColor.SetAlpha(this.GetTran()); d.LineToGround = !0; d.LineColor.FromHTMLColor(this.GetLineColor()); d.Scale = this.GetScale(); b.Position.AltitudeType = 0; b.Position.Altitude = Sp.GlobeCUtils.GetHeight(b.Position.X,
            b.Position.Y) + parseFloat(this.GetHight()); this._label = c.CreateLabel(b.Position, this.GetText(), 0, d, this.GetDrawGroup(), this.GetText()); this._label.Style.FrameFileName = ""; this.GetFrameImg() === !0 && this.SetFrameImg(!0); this.SetMsg(this._msg); this._label.TreeItem.ShowInViewerTree = !0; a.GetPrjTree().EditItem(this._label.ID, 1); this._RaiseActionEnd(!0)
        }
    }, _RaiseActionEnd: function (a) { this.OnActionEnd({ Feature: this._label, IsEdit: a }) }
});
Sp.GlobeTools.DrawImgTool = Sp.extend(Sp.GlobeTools.DrawTool, {
    constructor: function (a) {
        Sp.GlobeTools.DrawImgTool.superclass.constructor.apply(this, [a]); this._image = null; this._imageFile = String.format("{0}/Images/default.GIF", Sp.GetRootUrl()); this._lineColor = "#ffffff"; this._bgColor = "#808080"; this._toolTip = ""; this._hight = 0; this._scale = 3; this._tran = 0; this._msg = ""; this._frameimg = !0; this._treeName = "\u5bf9\u8c61"; this._OnRButtonUpHandler = Sp.Delegate(this, this._OnRButtonUp); this._OnInfoTreeActionHandler = Sp.Delegate(this,
        this._OnInfoTreeAction); this._OnLButtonUpHandler = Sp.Delegate(this, this._OnLButtonUp)
    }, GetImage: function () { return this._image }, SetImage: function (a) { this._image = a }, GetImageFile: function () { if (this._image != null) this._imageFile = this._image.ImageFileName; return this._imageFile }, SetImageFile: function (a) { /^http:\/\/.*/.test(a) ? this._imageFile = a : alert("\u56fe\u7247\u5730\u5740\u65e0\u6548\uff0c\u81ea\u52a8\u5207\u6362\u4e3a\u9ed8\u8ba4\u56fe\u7247\uff01"); if (this._image != null) this._image.ImageFileName = this._imageFile },
    GetHight: function () { if (this._image != null) this._hight = this._image.Position.Altitude - Sp.GlobeCUtils.GetHeight(this._image.Position.X, this._image.Position.Y); return this._hight }, SetHight: function (a) { this._hight = parseFloat(a); if (this._image != null) this._image.Position.Altitude = Sp.GlobeCUtils.GetHeight(this._image.Position.X, this._image.Position.Y) + parseFloat(a) }, GetScale: function () { if (this._image != null) this._scale = this._image.Style.Scale; return this._scale }, SetScale: function (a) {
        this._scale = a; if (this._image !=
        null) this._image.Style.Scale = a
    }, GetMsg: function () { if (this._image != null && this._image.Message != null) { var a = this._image.Message.MessageID; a = 1 * a.substr(a.indexOf("_") + 1); if (a != -1) this._msg = this.GetGlobe().GetCreator().GetObject(a).innerText } return this._msg }, SetMsg: function (a) { this._msg = a; if (this._image != null && this._image.Message != null) a = this._image.Message.MessageID, a = 1 * a.substr(a.indexOf("_") + 1), a != -1 && this.GetGlobe().GetCreator().DeleteObject(a), Sp.GlobeCUtils.CreateMessage(this._image, this._msg, "\u5bf9\u8c61\u63cf\u8ff0\u4fe1\u606f") },
    GetToolTip: function () { if (this._image != null) this._toolTip = this._image.Tooltip.Text; return this._toolTip }, SetToolTip: function (a) { this._toolTip = a; if (this._image != null) this._image.Tooltip.Text = this._toolTip }, GetFrameImg: function () { if (this._image != null) this._frameimg = /^http:\/\/.*/.test(this._image.Style.FrameFileName) ? !0 : !1; return this._frameimg }, SetFrameImg: function (a) { this._frameimg = a; if (this._image != null && this._frameimg === !0) this._image.Style.FrameFileName = Sp.GetRootUrl() + "/Images/frame-note.bmp" },
    GetTreeName: function () { if (this._image != null) this._treeName = this._image.TreeItem.Name; return this._treeName }, SetTreeName: function (a) { this._treeName = a; if (this._image != null) this._image.TreeItem.Name = this._treeName }, OnExecute: function (a) { var b = this.GetGlobe(); b.GetWindow().SetInputMode(1, this.GetCursor()); b.AddOnRButtonUp(this._OnRButtonUpHandler); b.AddOnLButtonUp(this._OnLButtonUpHandler); Sp.GlobeTools.DrawImgTool.superclass.OnExecute.apply(this, [a]) }, OnDeactive: function () {
        this.GetGlobe().GetWindow().SetInputMode(0);
        this.Dettach()
    }, Dettach: function () { var a = this.GetGlobe(); a.RemoveOnRButtonUp(this._OnRButtonUpHandler); a.RemoveOnLButtonUp(this._OnLButtonUpHandler); a.GetPrjTree().EndEdit() }, _OnRButtonUp: function () { this.Deactive(); this._RaiseActionEnd(!1); return !0 }, _OnLButtonUp: function (a, b, c) {
        a = this.GetGlobe(); b = a.GetWindow().PixelToWorld(b, c, -1); if (null == this._image) {
            c = a.GetCreator(); var d = c.CreateLabelStyle(0); d.FrameFileName = this.GetFrameImg(); d.LineToGround = !0; d.Scale = this._scale; b.Position.AltitudeType = 0; b.Position.Altitude =
            Sp.GlobeCUtils.GetHeight(b.Position.X, b.Position.Y) + parseFloat(this.GetHight()); this._image = c.CreateImageLabel(b.Position, this._imageFile, d, this.GetDrawGroup(), this._treeName); Sp.GlobeCUtils.SetTEClientData(this._image, "parentGroupId", this.GetDrawGroup()); this.SetMsg(this._msg); this._image.Style.FrameFileName = ""; this.GetFrameImg() === !0 && this.SetFrameImg(!0); this.SetToolTip(this._toolTip); this._image.TreeItem.ShowInViewerTree = !0; a.GetPrjTree().EditItem(this._image.ID, 1); this._RaiseActionEnd(!0)
        }
    },
    _RaiseActionEnd: function (a) { this.OnActionEnd({ Feature: this._image, IsEdit: a }) }
});
Sp.GlobeTools.AddModelTool = Sp.extend(Sp.GlobeTools.DrawTool, {
    constructor: function (a) { Sp.GlobeTools.AddModelTool.superclass.constructor.apply(this, [a]); this._model = null; this._scale = 0.005; this._modelType = 0; this._msg = null; this._toolTip = ""; this._hight = 0; this._treeName = "\u6a21\u578b"; this._modelFile = String.format("{0}/Images/default.Xpc", Sp.GetRootUrl()); this._OnRButtonUpHandler = Sp.Delegate(this, this._OnRButtonUp); this._OnLButtonUpHandler = Sp.Delegate(this, this._OnLButtonUp) }, GetModel: function () { return this._model },
    SetModel: function (a) { this._model = a }, GetTreeName: function () { if (this._model != null) this._treeName = this._model.TreeItem.Name; return this._treeName }, SetTreeName: function (a) { this._treeName = a; if (this._model != null) this._model.TreeItem.Name = this._treeName }, GetHight: function () { if (this._model != null) this._hight = this._model.Position.Altitude - Sp.GlobeCUtils.GetHeight(this._model.Position.X, this._model.Position.Y); return this._hight }, SetHight: function (a) {
        this._hight = parseFloat(a); if (this._model != null) this._model.Position.Altitude =
        Sp.GlobeCUtils.GetHeight(this._model.Position.X, this._model.Position.Y) + parseFloat(a)
    }, GetMsg: function () { if (this._model != null && this._model.Message != null) { var a = this._model.Message.MessageID; a = 1 * a.substr(a.indexOf("_") + 1); if (a != -1) this._msg = this.GetGlobe().GetCreator().GetObject(a).innerText } return this._msg }, SetMsg: function (a) {
        this._msg = a; if (this._model != null && this._model.Message != null) a = this._model.Message.MessageID, a = 1 * a.substr(a.indexOf("_") + 1), a != -1 && this.GetGlobe().GetCreator().DeleteObject(a),
        Sp.GlobeCUtils.CreateMessage(this._model, this._msg, "\u5bf9\u8c61\u63cf\u8ff0\u4fe1\u606f")
    }, GetToolTip: function () { if (this._model != null) this._toolTip = this._model.Tooltip.Text; return this._toolTip }, SetToolTip: function (a) { this._toolTip = a; if (this._model != null) this._model.Tooltip.Text = this._toolTip }, GetModelType: function () { if (this._model != null) this._modelType = this._model.ModelType; return this._modelType }, SetModelType: function (a) {
        a == 0 || a == 1 ? this._modelType = a : alert("\u8bbe\u7f6e\u53c2\u6570\u53ea\u80fd\u4e3a0\u62161");
        if (this._model != null) this._model.ModelType = this._modelType
    }, GetScale: function () { if (this._model != null) this._scale = this._model.ScaleFactor; return this._scale }, SetScale: function (a) { this._scale = a; if (this._model != null) this._model.ScaleFactor = this._scale }, GetModelFile: function () { if (this._model != null) this._modelFile = this._model.ModelFileName; return this._modelFile }, SetModelFile: function (a) {
        /^http:\/\/.*/.test(a) ? this._modelFile = a : alert("\u6a21\u578b\u5730\u5740\u65e0\u6548\uff0c\u81ea\u52a8\u5207\u6362\u4e3a\u9ed8\u8ba4\u6a21\u578b\uff01");
        if (this._model != null) this._model.ModelFileName = this._modelFile
    }, OnExecute: function () { var a = this.GetGlobe(); a.GetWindow().SetInputMode(1, this.GetCursor()); a.AddOnRButtonUp(this._OnRButtonUpHandler); a.AddOnLButtonUp(this._OnLButtonUpHandler) }, OnDeactive: function () { this.GetGlobe().GetWindow().SetInputMode(0); this.Dettach() }, Dettach: function () { var a = this.GetGlobe(); a.RemoveOnRButtonUp(this._OnRButtonUpHandler); a.RemoveOnLButtonUp(this._OnLButtonUpHandler); a.GetPrjTree().EndEdit() }, _OnRButtonUp: function (a,
    b, c) { this.Deactive(); this._RaiseActionEnd(b, c, !1); return !0 }, _OnLButtonUp: function (a, b, c) {
        a = this.GetGlobe(); var d = a.GetCreator(); b = a.GetWindow().PixelToWorld(b, c, -1); b.Position.AltitudeType = 0; b.Position.Altitude = Sp.GlobeCUtils.GetHeight(b.Position.X, b.Position.Y) + parseFloat(this.GetHight()); if (null == this._model) this._model = d.CreateModel(b.Position, this._modelFile, this._scale, this._modelType, this.GetDrawGroup(), this._treeName), this._model.Terrain.GroundObject = !0, this.SetMsg(this._msg), this._model.Tooltip.Text =
        this._toolTip, this._model.TreeItem.ShowInViewerTree = !0, a.GetPrjTree().EditItem(this._model.ID, 1), this._RaiseActionEnd(!0)
    }, _RaiseActionEnd: function (a) { this.OnActionEnd({ Feature: this._model, IsEdit: a }) }
});
Sp.GlobeTools.PolylineTool = Sp.extend(Sp.GlobeTools.DrawTool, {
    constructor: function (a) {
        Sp.GlobeTools.PolylineTool.superclass.constructor.apply(this, [a]); this._polyline = null; this._isEdit = !1; this._lineColor = "#ff0000"; this._lineWidth = this._lineOpacity = 1; this._bgColor = "#ff0000"; this._tooltip = this._msg = this._pattern = ""; this._treeName = "\u7ebf"; this._atitudeTypeCode = 2; this._atitude = 0; this._spline = !1; this._OnFrameHandler = Sp.Delegate(this, this._OnFrame); this._OnLButtonDownHandler = Sp.Delegate(this, this._OnLButtonDown);
        this._OnRButtonUpHandler = Sp.Delegate(this, this._OnRButtonUp)
    }, GetPolyline: function () { return this._polyline }, SetPolyline: function (a) { this._polyline = a }, GetOpacity: function () { if (this._polyline != null) this._lineOpacity = this._polyline.LineStyle.Color.GetAlpha(); return this._lineOpacity }, SetOpacity: function (a) { this._lineOpacity = a; this._polyline != null && this._polyline.LineStyle.Color.SetAlpha(this._lineOpacity) }, GetLineColor: function () {
        if (this._polyline != null) this._lineColor = this._polyline.LineStyle.Color.ToHTMLColor();
        return this._lineColor
    }, SetLineColor: function (a) { this._lineColor = a; this._polyline != null && this._polyline.LineStyle.Color.FromHTMLColor(this._lineColor) }, GetBGColor: function () { if (this._polyline != null) this._bgColor = this._polyline.LineStyle.BackColor.ToHTMLColor(); return this._bgColor }, SetBGColor: function (a) { this._bgColor = a; this._polyline != null && this._polyline.LineStyle.BackColor.FromHTMLColor(this._bgColor) }, GetSpline: function () { if (this._polyline != null) this._spline = this._polyline.Spline; return this._spline },
    SetSpline: function (a) { this._spline = a; if (this._polyline != null) this._polyline.Spline = this._spline }, GetLineWidth: function () { if (this._polyline != null) this._lineWidth = this._polyline.LineStyle.Width; return this._lineWidth }, SetLineWidth: function (a) { this._lineWidth = a; if (this._polyline != null) this._polyline.LineStyle.Width = this._lineWidth }, GetLinePattern: function () { if (this._polyline != null) this._pattern = this._polyline.LineStyle.Pattern; return this._pattern }, SetLinePattern: function (a) {
        this._pattern = a; if (this._polyline !=
        null) this._polyline.LineStyle.Pattern = this._pattern
    }, GetMsg: function () { if (this._polyline != null && this._polyline.Message != null) { var a = this._polyline.Message.MessageID; a = 1 * a.substr(a.indexOf("_") + 1); if (a != -1) this._msg = this.GetGlobe().GetCreator().GetObject(a).innerText } return this._msg }, SetMsg: function (a) {
        this._msg = a; if (this._polyline != null && this._polyline.Message != null) a = this._polyline.Message.MessageID, a = 1 * a.substr(a.indexOf("_") + 1), a != -1 && this.GetGlobe().GetCreator().DeleteObject(a), Sp.GlobeCUtils.CreateMessage(this._polyline,
        this._msg, "\u5bf9\u8c61\u63cf\u8ff0\u4fe1\u606f")
    }, GetAtitudeTypeCode: function () { if (this._polyline != null) this._atitudeTypeCode = this._polyline.Position.AltitudeType; return this._atitudeTypeCode }, SetAtitudeTypeCode: function (a) { this._atitudeTypeCode = a; if (this._polyline != null) this._polyline.Position.AltitudeType = this._atitudeTypeCode }, GetAtitude: function () { if (this._polyline != null) this._atitude = this._polyline.Position.Altitude; return this._atitude }, SetAtitude: function (a) {
        this._atitude = a; if (this._polyline !=
        null) this._polyline.Position.Altitude = this._atitude
    }, GetToolTip: function () { if (this._polyline != null) this._tooltip = this._polyline.Tooltip.Text; return this._tooltip }, SetToolTip: function (a) { this._tooltip = a; if (this._polyline != null) this._polyline.Tooltip.Text = this._tooltip }, GetTreeName: function () { if (this._polyline != null) this._treeName = this._polyline.TreeItem.Name; return this._treeName }, SetTreeName: function (a) { this._treeName = a; if (this._polyline != null) this._polyline.TreeItem.Name = this._treeName }, OnExecute: function () {
        var a =
        this.GetGlobe(); a.GetWindow().SetInputMode(1, this.GetCursor()); null == this._polyline ? (a.AddOnFrame(this._OnFrameHandler), a.AddOnLButtonDown(this._OnLButtonDownHandler), a.AddOnRButtonUp(this._OnRButtonUpHandler)) : this.EditVertics()
    }, OnDeactive: function (a) { var b = this.GetGlobe(); b.GetWindow().SetInputMode(0); b.RemoveOnFrame(this._OnFrameHandler); b.RemoveOnLButtonDown(this._OnLButtonDownHandler); b.RemoveOnRButtonUp(this._OnRButtonUpHandler); null != a && a === !0 && null != this._polyline && b.GetPrjTree().DeleteItem(this._polyline.ID) },
    _OnFrame: function () { if (null != this._polyline) { var a = this.GetGlobe().GetWindow(), b = a.GetMouseInfo(); a = a.PixelToWorld(b.X, b.Y, -1); b = this._polyline.Geometry.Points.Item(this._polyline.Geometry.Points.Count - 1); b.X = a.Position.X; b.Y = a.Position.Y; b.Z = a.Position.Altitude } }, _OnLButtonDown: function (a, b, c) {
        a = this.GetGlobe(); b = a.GetWindow().PixelToWorld(b, c, -1); null == this._polyline ? (c = a.GetCreator(), b = c.GeometryCreator.CreateLineStringGeometry([b.Position, b.Position]), this._polyline = c.CreatePolyline(b, this._lineColor,
        this._atitudeTypeCode, this.GetDrawGroup(), this._treeName), this._polyline.LineStyle.Width = this._lineWidth, this._polyline.LineStyle.Color.SetAlpha(this._lineOpacity), this._polyline.Spline = this._spline, this.SetMsg(this._msg), this._polyline.Tooltip.Text = this._tooltip, this._polyline.TreeItem.ShowInViewerTree = !0, this._polyline.Geometry.StartEdit()) : this._polyline.Geometry.Points.AddPoint(b.Position.X, b.Position.Y, b.Position.Altitude)
    }, _OnRButtonUp: function () {
        this.Deactive(); var a = this.GetGlobe(); null ==
        this._polyline ? this.OnActionEnd({ Feature: this._polyline, IsEdit: !1 }) : this._isEdit ? (this._polyline.Geometry.EndEdit(), a.GetPrjTree().EndEdit(), this._isEdit = !1, this.OnActionEnd({ Feature: this._polyline, IsEdit: !1 })) : (this._polyline.Geometry.Points.Count < 3 || (this._polyline.Geometry.Points.DeletePoint(this._polyline.Geometry.Points.Count - 1), a.GetPrjTree().EndEdit()), this._polyline.Geometry.EndEdit(), this.OnActionEnd({ Feature: this._polyline, IsEdit: !0 })); return !0
    }, EditVertics: function () {
        var a = this.GetGlobe();
        this._polyline.Geometry.StartEdit(); a.GetPrjTree().EditItem(this._polyline.ID, 2); a.AddOnRButtonUp(this._OnRButtonUpHandler); this._isEdit = !0
    }
});
Sp.GlobeTools.DynamicObjTool = Sp.extend(Sp.GlobeTools.DrawTool, {
    constructor: function (a) {
        Sp.GlobeTools.DynamicObjTool.superclass.constructor.apply(this, [a]); this._polyline = null; this._modelfile = ""; this._scalefactor = 0.005; this._toolTip = this._msg = ""; this._dynamicType = null; this._speed = 100; this._motionstyle = null; this._cirroute = !1; this._turnspeed = 360; this._acceleration = 10; this._lineOpacity = 0; this._model = null; this._modelHeight = 0; this._treeName = "\u52a8\u6001\u8def\u5f841"; this._tool = new Sp.GlobeTools.PolylineTool(a);
        this._tool.AddActionEnd(Sp.Delegate(this, this._OnLoadLine))
    }, GetModelHeight: function () { return this._modelHeight }, SetModelHeight: function (a) { this._modelHeight = a }, GetModel: function () { return this._model }, SetModel: function (a) { this._model = a }, GetTreeName: function () { return this._treeName }, SetTreeName: function (a) { this._treeName = a }, GetToolTip: function () { return this._toolTip }, SetToolTip: function (a) { this._toolTip = a }, GetAltitude: function () { return this._altitude }, SetAltitude: function (a) { this._altitude = a }, GetMsg: function () { return this._msg },
    SetMsg: function (a) { this._msg = a }, GetDynamicType: function () { return this._dynamicType }, SetDynamicType: function (a) { this._dynamicType = a }, GetPolyline: function () { return this._polyline }, SetPolyline: function (a) { this._polyline = a }, GetOpacity: function () { return this._lineOpacity }, SetOpacity: function (a) { this._lineOpacity = a }, GetMotionStyle: function () { return this._motionstyle != null ? this._motionstyle : this._motionstyle = 0 }, SetMotionStyle: function (a) { this._motionstyle = a }, GetModelFile: function () {
        if ("" === this._modelfile) this._modelfile =
        String.format("{0}/Images/default.Xpc", Sp.GetRootUrl()); return this._modelfile
    }, SetModelFile: function (a) { this._modelfile = a }, GetSpeed: function () { return this._speed }, SetSpeed: function (a) { this._speed = a }, GetCircularRoute: function () { return this._cirroute }, SetCircularRoute: function (a) { this._cirroute = a }, GetTurnSpeed: function () { return this._turnspeed }, SetTurnSpeed: function (a) { this._turnspeed = a }, GetScaleFactor: function () { return this._scalefactor }, SetScaleFactor: function (a) { this._scalefactor = a }, GetAcceleration: function () { return this._acceleration },
    SetAcceleration: function (a) { this._acceleration = a }, OnExecute: function (a) { this._tool.Execute(a) }, OnDeactive: function (a) { this.Dettach(a) }, Dettach: function (a) { this._tool.Deactive(a) }, _OnLoadLine: function (a, b) {
        var c = this.GetGlobe(); if (b.IsEdit) {
            for (var d = b.Feature, e = d.Geometry.Points.count, f, g = [], h = 0; h < e; h++) { f = d.Geometry.Points(h).x; var i = d.Geometry.Points(h).y, j = this.GetSpeed() * 5 / 18; f = c.GetCreator().CreateRouteWaypoint(f, i, this.GetModelHeight(), j, 0, 0, 0, 0, 0, 0); g.push(f) } c.GetPrjTree().DeleteItem(d.ID);
            this._model = c.GetCreator().CreateDynamicObject(g, this.GetMotionStyle(), 0, this.GetModelFile(), this.GetScaleFactor(), 0, this.GetDrawGroup(), this.GetTreeName()); this._model.TurnSpeed = this.GetTurnSpeed(); this._model.CircularRoute = this.GetCircularRoute(); this._model.Acceleration = this.GetAcceleration(); this.GetMsg() != "" && Sp.GlobeCUtils.CreateMessage(this._model, this.GetMsg(), "\u5bf9\u8c61\u63cf\u8ff0\u4fe1\u606f", 0, 200, 150); if (this.GetToolTip() != "") this._model.Tooltip.Text = this.GetToolTip()
        } this.OnActionEnd({
            Feature: this._model,
            IsEdit: !1
        })
    }
});
Sp.GlobeTools.PolygonTool = Sp.extend(Sp.GlobeTools.DrawTool, {
    constructor: function (a) {
        Sp.GlobeTools.PolygonTool.superclass.constructor.apply(this, [a]); this._msg = this._tooltip = ""; this._treeName = "\u591a\u8fb9\u5f62"; this._polygon = this._polyline = null; this._isEdit = !1; this._lineColor = "#ff0000"; this._lineWidth = this._lineOpacity = 1; this._fillOpacity = 0.5; this._fillColor = "#ff0000"; this._atitudeTypeCode = 2; this._OnFrameHandler = Sp.Delegate(this, this._OnFrame); this._OnLButtonDownHandler = Sp.Delegate(this, this._OnLButtonDown);
        this._OnRButtonUpHandler = Sp.Delegate(this, this._OnRButtonUp)
    }, GetPolygon: function () { return this._polygon }, SetPolygon: function (a) { this._polygon = a }, GetLineColor: function () { return this._lineColor }, SetLineColor: function (a) { this._lineColor = a }, GetOpacity: function () { return this._lineOpacity }, SetOpacity: function (a) { this._lineOpacity = a }, GetLineWidth: function () { return this._lineWidth }, SetLineWidth: function (a) { this._lineWidth = a }, GetMsg: function () { return this._msg }, SetMsg: function (a) { this._msg = a }, GetToolTip: function () { return this._tooltip },
    SetToolTip: function (a) { this._tooltip = a }, GetFillOpacity: function () { return this._fillOpacity }, SetFillOpacity: function (a) { this._fillOpacity = a }, GetFillColor: function () { return this._fillColor }, SetFillColor: function (a) { this._fillColor = a }, GetTreeName: function () { return this._treeName }, SetTreeName: function (a) { this._treeName = a }, OnExecute: function (a) {
        var b = this.GetGlobe(); b.GetWindow().SetInputMode(1, this.GetCursor()); null == this._polygon ? (b.AddOnFrame(this._OnFrameHandler), b.AddOnLButtonDown(this._OnLButtonDownHandler),
        b.AddOnRButtonUp(this._OnRButtonUpHandler)) : this.EditVertics(); Sp.GlobeTools.PolygonTool.superclass.OnExecute.apply(this, [a])
    }, OnDeactive: function (a) { var b = this.GetGlobe(); b.GetWindow().SetInputMode(0); b.RemoveOnFrame(this._OnFrameHandler); b.RemoveOnLButtonDown(this._OnLButtonDownHandler); b.RemoveOnRButtonUp(this._OnRButtonUpHandler); null != a && a === !0 && (null != this._polyline && b.GetPrjTree().DeleteItem(this._polyline.ID), null != this._polygon && b.GetPrjTree().DeleteItem(this._polygon.ID)) }, _OnFrame: function () {
        var a =
        this.GetGlobe().GetWindow(); if (null != this._polyline) { var b = a.GetMouseInfo(); a = a.PixelToWorld(b.X, b.Y, 0); b = this._polyline.Geometry.Points.Item(this._polyline.Geometry.Points.Count - 1); b.X = a.Position.X; b.Y = a.Position.Y; b.Z = a.Position.Altitude } else if (!(null == this._polygon || this._polygon.Geometry.ExteriorRing.Points.Count <= 0)) b = a.GetMouseInfo(), a = a.PixelToWorld(b.X, b.Y, 0), b = this._polygon.Geometry.ExteriorRing.Points.Item(this._polygon.Geometry.ExteriorRing.Points.Count - 1), b.X = a.Position.X, b.Y = a.Position.Y,
        b.Z = a.Position.Altitude
    }, _OnLButtonDown: function (a, b, c) {
        a = this.GetGlobe(); c = a.GetWindow().PixelToWorld(b, c, 0); if (null == this._polygon) if (b = a.GetCreator(), null == this._polyline) { var d = b.GeometryCreator.CreateLineStringGeometry([c.Position, c.Position]); this._polyline = b.CreatePolyline(d, this.GetLineColor(), this._atitudeTypeCode, this.GetDrawGroup(), ""); this._polyline.LineStyle.Width = this.GetLineWidth(); this._polyline.LineStyle.Color.SetAlpha(this.GetFillOpacity()); this._polyline.Geometry.StartEdit() } else if (this._polyline.Geometry.Points.Count <
        3) this._polyline.Geometry.Points.AddPoint(c.Position.X, c.Position.Y, c.Position.Altitude); else try {
            d = this._polyline.Geometry.Points; var e = b.GeometryCreator.CreateLinearRingGeometry([d.Item(0).X, d.Item(0).Y, d.Item(0).Z, d.Item(1).X, d.Item(1).Y, d.Item(1).Z, d.Item(2).X, d.Item(2).Y, d.Item(2).Z, c.Position.X, c.Position.Y, c.Position.Altitude]), f = b.GeometryCreator.CreatePolygonGeometry(e, null); this._polygon = b.CreatePolygon(f, this.GetLineColor(), this.GetFillColor(), this._atitudeTypeCode, this.GetDrawGroup(),
            this.GetTreeName()); this._polygon.LineStyle.Width = this.GetLineWidth(); this._polygon.LineStyle.Color.SetAlpha(this.GetOpacity()); this._polygon.FillStyle.Color.SetAlpha(this.GetFillOpacity()); this.GetMsg() != "" && Sp.GlobeCUtils.CreateMessage(this._polygon, this.GetMsg(), "\u5bf9\u8c61\u63cf\u8ff0\u4fe1\u606f", 0, 200, 150); if (this.GetToolTip() != "") this._polygon.Tooltip.Text = this.GetToolTip(); this._polygon.TreeItem.ShowInViewerTree = !0; this._polygon.Geometry.StartEdit(); a.GetPrjTree().DeleteItem(this._polyline.ID);
            this._polyline = null
        } catch (g) { return alert("\u7ed8\u5236\u7ebf\u6bb5\u4e0d\u80fd\u751f\u6210\u591a\u8fb9\u5f62\uff01"), this.Deactive(), a.GetPrjTree().DeleteItem(this._polyline.ID), !0 } else this._polygon.Geometry.ExteriorRing.Points.AddPoint(c.Position.X, c.Position.Y, c.Position.Altitude)
    }, _OnRButtonUp: function () {
        this.Deactive(); var a = this.GetGlobe(); if (null != this._polyline) return a.GetPrjTree().DeleteItem(this._polyline.ID), this._polyline = null, this.OnActionEnd({ Feature: this._polygon, IsEdit: !1, isPart: !0 }),
        !0; else if (null == this._polygon) return this.OnActionEnd({ Feature: this._polygon, IsEdit: !1 }), !0; this._isEdit ? (this._polygon.Geometry.EndEdit(), a.GetPrjTree().EndEdit(), this._isEdit = !1, this.OnActionEnd({ Feature: this._polygon, IsEdit: !1 })) : (this._polygon.Geometry.ExteriorRing.Points.Count > 3 && (this._polygon.Geometry.ExteriorRing.Points.DeletePoint(this._polygon.Geometry.ExteriorRing.Points.Count - 1), a.GetPrjTree().EndEdit()), this._polygon.Geometry.EndEdit(), this.OnActionEnd({ Feature: this._polygon, IsEdit: !0 }));
        return !0
    }, EditVertics: function () { var a = this.GetGlobe(); this._polygon.Geometry.StartEdit(); a.GetPrjTree().EditItem(this._polygon.ID, 2); a.AddOnRButtonUp(this._OnRButtonUpHandler); this._isEdit = !0 }
});
Sp.GlobeTools.RectangleTool = Sp.extend(Sp.GlobeTools.DrawTool, {
    constructor: function (a) { Sp.GlobeTools.RectangleTool.superclass.constructor.apply(this, [a]); this._polygon = null; this._lineColor = "#ff0000"; this._lineOpacity = 0.5; this._lineWidth = 1; this._fillOpacity = 0.5; this._fillColor = "#ff0000"; this._mouseDowNum = -1; this._firstPoint = null; this._OnFrameHandler = Sp.Delegate(this, this._OnFrame); this._OnLButtonDownHandler = Sp.Delegate(this, this._OnLButtonDown); this._OnRButtonUpHandler = Sp.Delegate(this, this._OnRButtonUp) },
    GetRectangle: function () { return this._polygon }, SetRectangle: function (a) { this._polygon = a }, GetLineColor: function () { return this._lineColor }, SetLineColor: function (a) { this._lineColor = a; null != this._polygon && this._polygon.LinStyle.Color.FromRGBColor(this._lineColor) }, GetOpacity: function () { return this._lineOpacity }, SetOpacity: function (a) { this._lineOpacity = a; null != this._polygon && this._polygon.LineStyle.Color.SetAlpha(this._lineOpacity) }, GetLineWidth: function () { return this._lineWidth }, SetLineWidth: function (a) {
        this._lineWidth =
        a; if (null != this._polygon) this._polygon.LineStyle.Width = this._lineWidth
    }, GetFillOpacity: function () { return this._fillOpacity }, SetFillOpacity: function (a) { this._fillOpacity = a; null != this._polygon && this._polygon.FillStyle.Color.SetAlpha(this._fillOpacity) }, GetFillColor: function () { return this._fillColor }, SetFillColor: function (a) { this._fillColor = a; null != this._polygon && this._polygon.FillStyle.Color.FromRGBColor(this._fillColor) }, OnExecute: function (a) {
        var b = this.GetGlobe(); b.GetWindow().SetInputMode(1, this.GetCursor());
        null == this._polygon ? (b.AddOnLButtonDown(this._OnLButtonDownHandler), b.AddOnFrame(this._OnFrameHandler), b.AddOnRButtonUp(this._OnRButtonUpHandler)) : (this.EditVertics(), this.OnActionEnd(this._polygon)); Sp.GlobeTools.RectangleTool.superclass.OnExecute.apply(this, [a])
    }, OnDeactive: function () { var a = this.GetGlobe(); a.GetWindow().SetInputMode(0); a.RemoveOnFrame(this._OnFrameHandler); a.RemoveOnLButtonDown(this._OnLButtonDownHandler); a.RemoveOnRButtonUp(this._OnRButtonUpHandler) }, _OnFrame: function () {
        if (!(null ==
        this._polygon || this._mouseDowNum == -1)) { var a = this.GetGlobe().GetWindow(), b = a.GetMouseInfo(); a = a.PixelToWorld(b.X, b.Y, 0); this._polygon.Right = a.Position.X; this._polygon.Bottom = a.Position.Y }
    }, _OnLButtonDown: function (a, b, c) {
        this._mouseDowNum++; a = this.GetGlobe(); b = a.GetWindow().PixelToWorld(b, c, -1); b.Position.AltitudeType = 2; if (0 == this._mouseDowNum) {
            if (this._firstPoint = b, null == this._polygon) this._polygon = a.GetCreator().CreateRectangle(b.Position, 0, 0, this.GetLineColor(), this.GetFillColor(), this.GetDrawGroup(),
            ""), this._polygon.LineStyle.Width = this.GetLineWidth(), this.SetOpacity(this.GetOpacity()), this.SetFillOpacity(this.GetFillOpacity())
        } else return this.Deactive(), this.OnActionEnd({ Feature: this._polygon }), this._mouseDowNum = -1, !0
    }, _OnRButtonUp: function () { this.Deactive(); var a = this.GetGlobe(); if (null != this._polygon) a.GetPrjTree().DeleteItem(this._polygon.ID), this._polygon = null; this.OnActionEnd({ Feature: this._polygon }); return !0 }
});
Sp.GlobeTools.CircleTool = Sp.extend(Sp.GlobeTools.DrawTool, {
    constructor: function (a) {
        Sp.GlobeTools.CircleTool.superclass.constructor.apply(this, [a]); this._circle = null; this._lineColor = 255; this._lineWidth = this._lineOpacity = 1; this._fillOpacity = 0.5; this._fillColor = 255; this._segments = 30; this._oringin = null; this._showRaidus = !0; this._radiusLine = this._radiusTextLabel = null; this._mouseDowNum = -1; this._OnFrameHandler = Sp.Delegate(this, this._OnFrame); this._OnLButtonDownHandler = Sp.Delegate(this, this._OnLButtonDown);
        this._OnRButtonUpHandler = Sp.Delegate(this, this._OnRButtonUp)
    }, GetOringin: function () { return this._oringin }, GetPolygon: function () { return this._circle }, SetPolygon: function (a) { this._circle = a }, GetLineColor: function () { return this._lineColor }, SetLineColor: function (a) { this._lineColor = a; if (null != this._circle) this._circle.FgColor = this._lineColor }, GetOpacity: function () { return this._lineOpacity }, SetOpacity: function (a) { this._lineOpacity = a; if (null != this._circle) this._circle.FgAlpha = this._lineOpacity }, GetLineWidth: function () { return this._lineWidth },
    SetLineWidth: function (a) { this._lineWidth = a; if (null != this._circle) this._circle.LineStyle.Width = this._lineWidth }, GetFillOpacity: function () { return this._fillOpacity }, SetFillOpacity: function (a) { this._fillOpacity = a; null != this._circle && this._circle.FillStyle.Color.SetAlpha(this._fillOpacity) }, GetFillColor: function () { return this._fillColor }, SetFillColor: function (a) { this._fillColor = a; if (null != this._circle) this._circle.BgColor = this._fillColor }, GetSegments: function () { return this._segments }, SetSegments: function (a) {
        this._segments =
        a; if (null != this._circle) this._circle.NumberOfSegments = this._segments
    }, GetShowRaidus: function () { return this._showRaidus }, SetShowRaidus: function (a) { this._showRaidus = a }, OnExecute: function (a) {
        var b = this.GetGlobe(); b.GetWindow().SetInputMode(1, this.GetCursor()); null == this._circle ? (b.AddOnLButtonDown(this._OnLButtonDownHandler), b.AddOnRButtonUp(this._OnRButtonUpHandler), b.AddOnFrame(this._OnFrameHandler)) : (this.EditVertics(), this.OnActionEnd(this._circle, this._circle.Position, this._circle.Radius)); Sp.GlobeTools.CircleTool.superclass.OnExecute.apply(this,
        [a])
    }, OnDeactive: function () { var a = this.GetGlobe(); a.GetWindow().SetInputMode(0); a.RemoveOnFrame(this._OnFrameHandler); a.RemoveOnLButtonDown(this._OnLButtonDownHandler); a.RemoveOnRButtonUp(this._OnRButtonUpHandler); this._radiusTextLabel != null && a.GetPrjTree().DeleteItem(this._radiusTextLabel.ID); this._radiusLine != null && a.GetPrjTree().DeleteItem(this._radiusLine.ID); this._radiusLine = this._radiusTextLabel = null }, EditVertics: function () { var a = this.GetGlobe(); a.GetPrjTree().EditItem(this._circle.ID, 2); a.AddOnRButtonUp(this._OnRButtonUpHandler) },
    _OnFrame: function () {
        if (!(null == this._circle || this._mouseDowNum == -1)) {
            var a = this.GetGlobe(), b = a.GetWindow(), c = b.GetMouseInfo(); b = b.PixelToWorld(c.X, c.Y, 0); c = this._oringin; a = a.GetCoord().GetDistance(c.X, c.Y, b.Position.X, b.Position.Y); this._circle.Radius = a; if (this._showRaidus) null == this._radiusTextLabel && this._CreateRaidusLine(this._oringin, b.Position), this._radiusTextLabel.Text = a > 1E3 ? Math.round(a / 1E3 * 1E3) / 1E3 + "\u516c\u91cc" : Math.round(a / 100 * 100) + "\u7c73", this._radiusTextLabel.Position.X = (c.X + b.Position.X) /
            2, this._radiusTextLabel.Position.Y = (c.Y + b.Position.Y) / 2, this._radiusTextLabel.Position.Altitude = 0, a = this._radiusLine.Geometry.Points.Item(this._radiusLine.Geometry.Points.Count - 1), a.X = b.Position.X, a.Y = b.Position.Y, a.Z = b.Position.Altitude
        }
    }, _OnLButtonDown: function (a, b, c) {
        this._mouseDowNum++; a = this.GetGlobe(); if (0 == this._mouseDowNum) {
            if (b = a.GetWindow().PixelToWorld(b, c, 0), b.Position.AltitudeType = 2, null == this._circle) this._circle = a.GetCreator().CreateCircle(b.Position, 0, this.GetLineColor(), this.GetFillColor(),
            this.GetDrawGroup(), ""), this.SetSegments(this.GetSegments()), this.SetLineWidth(this.GetLineWidth()), this.SetFillOpacity(this.GetFillOpacity()), this._oringin = b.Position
        } else this.Deactive(), a.GetPrjTree().EndEdit(), this.OnActionEnd({ Feature: this._circle, Origin: this._oringin, Radius: this._circle.Radius }), this._mouseDowNum = -1
    }, _OnRButtonUp: function () { this.Deactive(); globe.GetPrjTree().EndEdit(); return !0 }, _CreateRaidusLine: function (a, b) {
        var c = this.GetGlobe().GetCreator(), d = c.CreateLabelStyle(0); a.AltitudeType =
        2; this._radiusTextLabel = c.CreateLabel(a, "0\u7c73", "", d, this.GetDrawGroup(), ""); d = c.GeometryCreator.CreateLineStringGeometry([a, b]); this._radiusLine = c.CreatePolyline(d, this.GetLineColor(), 2, this.GetDrawGroup(), ""); this._radiusLine.LineStyle.Width = this.GetLineWidth(); this._radiusLine.LineStyle.Color.SetAlpha(this.GetOpacity()); this._radiusLine.Geometry.StartEdit()
    }
});
Sp.GlobeTools.ArrowTool = Sp.extend(Sp.GlobeTools.DrawTool, {
    constructor: function (a) {
        Sp.GlobeTools.ArrowTool.superclass.constructor.apply(this, [a]); this._arrow = null; this._style = 4; this._lineWidth = this._lineOpacity = 1; this._fillOpacity = 0; this._toolTip = this._msg = ""; this._lineColor = this._fillColor = "#FF0000"; this._treeName = "\u7bad\u5934"; this._mouseDowNum = -1; this._isEdit = !1; this._OnFrameHandler = Sp.Delegate(this, this._OnFrame); this._OnLButtonDownHandler = Sp.Delegate(this, this._OnLButtonDown); this._OnRButtonUpHandler =
        Sp.Delegate(this, this._OnRButtonUp)
    }, GetArrow: function () { return this._arrow }, SetArrow: function (a) { this._arrow = a }, GetToolTip: function () { return this._toolTip }, SetToolTip: function (a) { this._toolTip = a }, GetMsg: function () { return this._msg }, SetMsg: function (a) { this._msg = a }, GetTreeName: function () { return this._treeName }, SetTreeName: function (a) { this._treeName = a }, GetLineColor: function () { return this._lineColor }, SetLineColor: function (a) { this._lineColor = a }, GetOpacity: function () { return this._lineOpacity }, SetOpacity: function (a) {
        this._lineOpacity =
        a
    }, GetLineWidth: function () { return this._lineWidth }, SetLineWidth: function (a) { this._lineWidth = a }, GetFillOpacity: function () { return this._fillOpacity }, SetFillOpacity: function (a) { this._fillOpacity = a }, GetFillColor: function () { return this._fillColor }, SetFillColor: function (a) { this._fillColor = a }, GetStyle: function () { return this._style }, SetStyle: function (a) { this._style = a }, OnExecute: function (a) {
        var b = this.GetGlobe(); b.GetWindow().SetInputMode(1, this.GetCursor()); null == this._arrow ? (b.AddOnLButtonDown(this._OnLButtonDownHandler),
        b.AddOnRButtonUp(this._OnRButtonUpHandler), b.AddOnFrame(this._OnFrameHandler)) : (this.EditVertics(), this.OnActionEnd(this._arrow)); Sp.GlobeTools.ArrowTool.superclass.OnExecute.apply(this, [a])
    }, OnDeactive: function (a) { var b = this.GetGlobe(); b.GetWindow().SetInputMode(0); b.RemoveOnFrame(this._OnFrameHandler); b.RemoveOnLButtonDown(this._OnLButtonDownHandler); b.RemoveOnRButtonUp(this._OnRButtonUpHandler); null != a && a === !0 && null != this._arrow && b.GetPrjTree().DeleteItem(this._arrow.ID) }, _OnRButtonUp: function () {
        var a =
        this.GetGlobe(); if (null == this._arrow) return this.OnActionEnd({ Feature: this._arrow, IsEdit: !1 }), !0; if (this._isEdit) a.GetPrjTree().EndEdit(), this._isEdit = !1, this.OnActionEnd({ Feature: this._polygon, IsEdit: !1 }); return !0
    }, _OnFrame: function () { if (!(null == this._arrow || this._mouseDowNum == -1)) { var a = this.GetGlobe().GetWindow(), b = a.GetMouseInfo(); a = a.PixelToWorld(b.X, b.Y, -1); this._arrow.HeadX = a.Position.X; this._arrow.HeadY = a.Position.Y } }, _OnLButtonDown: function (a, b, c) {
        this._mouseDowNum++; a = this.GetGlobe(); if (0 ==
        this._mouseDowNum) {
            if (b = a.GetWindow().PixelToWorld(b, c, -1), b.Position.AltitudeType = 2, null == this._arrow && (this._arrow = a.GetCreator().CreateArrow(b.Position, 1, this.GetStyle(), this.GetLineColor(), this.GetFillColor(), this.GetDrawGroup(), this.GetTreeName()), this._arrow.FillStyle.Color.SetAlpha(this.GetFillOpacity()), this._arrow.LineStyle.Width = this.GetLineWidth(), this._arrow.TailX = b.Position.X, this._arrow.TailY = b.Position.Y, this.GetMsg() != "" && Sp.GlobeCUtils.CreateMessage(this._arrow, this.GetMsg(), "\u5bf9\u8c61\u63cf\u8ff0\u4fe1\u606f",
            0, 200, 150), this.GetToolTip() != "")) this._arrow.Tooltip.Text = this.GetToolTip()
        } else this.Deactive(), a.GetPrjTree().EndEdit(), this.OnActionEnd({ Feature: this._arrow, IsEdit: !0 }), this._mouseDowNum = -1
    }, EditVertics: function () { var a = this.GetGlobe(); a.GetPrjTree().EditItem(this._arrow.ID, 1); a.AddOnRButtonUp(this._OnRButtonUpHandler); this._isEdit = !0 }
});
Sp.GlobeTools.PointSelectTool = Sp.extend(Sp.GlobeTools.DrawTool, {
    constructor: function (a) { Sp.GlobeTools.PointSelectTool.superclass.constructor.apply(this, [a]); this._globe = this.GetGlobe(); this._object = null; this._OnRButtonUpHandler = Sp.Delegate(this, this._OnRButtonUp); this._OnLButtonUpHandler = Sp.Delegate(this, this._OnLButtonUp) }, OnExecute: function () { this._globe.GetWindow().SetInputMode(1, this.GetCursor()); this._globe.AddOnRButtonUp(this._OnRButtonUpHandler); this._globe.AddOnLButtonUp(this._OnLButtonUpHandler) },
    OnDeactive: function (a) { this.Dettach(a) }, Dettach: function () { this._globe.RemoveOnLButtonUp(this._OnLButtonUpHandler); this._globe.RemoveOnRButtonUp(this._OnRButtonUpHandler); this._globe.GetWindow().SetInputMode(0) }, _OnRButtonUp: function () { this.Deactive(); return !0 }, _OnLButtonUp: function (a, b, c) {
        this._object = null; this._globe.GetPrjTree(); a = this._globe.GetWindow().PixelToWorld(b, c, -1); b = a.ObjectID; if (b != "") Sp.GlobeCUtils.ActivateInternetLicence(this._globe), this._object = this._globe.GetCreator().GetObject(b);
        this._RaiseActionEnd(a)
    }, _RaiseActionEnd: function (a) { this.OnActionEnd({ Feature: this._object, CurrentPoint: a.Position }) }
});
